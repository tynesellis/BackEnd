let MarkerData=[],Comments=[];const GetMarkerData=$.ajax({Method:"Get",url:"/Markers/GetMarkers"}).then(function(n){MarkerData=n}),GetComments=$.ajax({Method:"Get",url:"Comments/GetComments"}).then(function(n){Comments=n}),makeMarker=function(n,t,i){const u=new google.maps.Marker({map:t,position:n,icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png",animation:google.maps.Animation.DROP});let e=Comments.filter(n=>n.markerId===i.id).sort((n,t)=>t.commentId-n.commentId),r=`
                    <div class="infoWindowContainer">
                    <h5>${i.title}</h5>
                    <h5>${i.address}</h5>
                    <p class="disclaimer">***DO NOT VISIT ANY PROPERTY WITHOUT PERMSSION OF OWNER***</p>
                    <div class="infoWindowPicDiv">
                    <img src="${i.image.imageURL}" alt="${i.image.imageName}">
                    </div>
                    <p>${i.description}</p>
                    `;r+=i.citation.source.includes("http")?`
                        <a class="sourceLink" href="${i.citation.source}" target="_blank">Source: ${i.citation.source}</a>
                        `:`<p>Source: ${i.citation.source}</p>
    `;r+=`
                       <div class="commentsDiv">
                       <h5>Comments</h5>
                       `;e.forEach(n=>{r+=`
            <p class="commentsDiv_User">${n.userName} says: </p>
            <p id=${n.markerId} class="comment">${n.commentString}</p>
        `});r+=`
                       </div>
                       <button class="addComment" id="${i.id}">Add Comment</button>
                       </div>
                       `;var f=new google.maps.InfoWindow({content:r,maxWidth:500,maxHeight:200});u.setMap(t);u.addListener("click",function(){$("#map").css("height","100vh");f.open(t,u);google.maps.event.addListener(t,"click",function(){f.close();$("#map").css("height","30em");t.setCenter(n)});google.maps.event.addListener(f,"closeclick",function(){$("#map").css("height","30em");t.setCenter(n)})})},setCenterMarker=function(){let i=new google.maps.Map(document.getElementById("map"),{zoom:12}),n=new google.maps.Geocoder;const t=$("#address").val();n.geocode({address:t},function(n,t){var i,u;const r=new google.maps.LatLngBounds;if(t==="OK")if(n[0].address_components[4].long_name!=="Davidson County")i=new google.maps.Map(document.getElementById("map"),{zoom:12,center:n[0].geometry.location}),u=new google.maps.Marker({map:i,position:n[0].geometry.location,label:"*"}),alert("Please Enter An Address in Nashville, Davidson County");else{i=new google.maps.Map(document.getElementById("map"),{zoom:12,center:n[0].geometry.location});let t=parseFloat(i.center.lat()),f=parseFloat(i.center.lng());r.extend({lat:t,lng:f});u=new google.maps.Marker({map:i,position:n[0].geometry.location,label:"*"});const u=[];if(MarkerData.forEach(n=>{const e={lat:parseFloat(n.lat),lng:parseFloat(n.lng)};console.log(t);console.log(clong);console.log(n.lat);console.log(n.lng);console.log("test");let o=google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(t,f),new google.maps.LatLng(parseFloat(n.lat),parseFloat(n.lng)));console.log(o);o<16093.4?(makeMarker(e,i,n),r.extend(e)):(n.distance=o,n.newLatLong=e,u.push(n))}),u.length===MarkerData.length){const n=u.sort((n,t)=>t.distance-n.distance).slice(0,2);n.forEach(n=>{makeMarker(n.newLatLong,i,n),r.extend(n.newLatLong)})}i.setCenter(r.getCenter());i.fitBounds(r);i.setZoom(i.getZoom()-1)}else alert("Geocode was not successful for the following reason: "+t);$("#address").val("")})};$("#submit").on("click",setCenterMarker);$("#address").on("keyup",function(n){n.keyCode===13&&setCenterMarker()});